/*! Project:pixi-apngAndGi, Create:FWS 2018.09.28 15:29, Update:FWS 2020.03.10 09:00 */ 
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("pako")):"function"==typeof define&&define.amd?define(["pako"],r):e.PixiApngAndGif=r(e.pako)}(this,function(e){"use strict";function r(e){var r=0;if(71!==e[r++]||73!==e[r++]||70!==e[r++]||56!==e[r++]||56!=(e[r++]+1&253)||97!==e[r++])throw new Error("Invalid GIF 87a/89a header.");var a=e[r++]|e[r++]<<8,n=e[r++]|e[r++]<<8,i=e[r++],o=i>>7,f=7&i,s=1<<f+1;e[r++];e[r++];var l=null,u=null;o&&(l=r,u=s,r+=3*s);var c=!0,d=[],v=0,h=null,p=0,g=null;for(this.width=a,this.height=n;c&&r<e.length;)switch(e[r++]){case 33:switch(e[r++]){case 255:if(11!==e[r]||78==e[r+1]&&69==e[r+2]&&84==e[r+3]&&83==e[r+4]&&67==e[r+5]&&65==e[r+6]&&80==e[r+7]&&69==e[r+8]&&50==e[r+9]&&46==e[r+10]&&48==e[r+11]&&3==e[r+12]&&1==e[r+13]&&0==e[r+16])r+=14,g=e[r++]|e[r++]<<8,r++;else for(r+=12;;){var m=e[r++];if(!(m>=0))throw Error("Invalid block size");if(0===m)break;r+=m}break;case 249:if(4!==e[r++]||0!==e[r+4])throw new Error("Invalid graphics extension block.");var y=e[r++];v=e[r++]|e[r++]<<8,h=e[r++],0==(1&y)&&(h=null),p=y>>2&7,r++;break;case 254:for(;;){var m=e[r++];if(!(m>=0))throw Error("Invalid block size");if(0===m)break;r+=m}break;default:throw new Error("Unknown graphic control label: 0x"+e[r-1].toString(16))}break;case 44:var b=e[r++]|e[r++]<<8,w=e[r++]|e[r++]<<8,_=e[r++]|e[r++]<<8,A=e[r++]|e[r++]<<8,I=e[r++],x=I>>7,U=I>>6&1,T=7&I,k=1<<T+1,R=l,q=u,z=!1;if(x){var z=!0;R=r,q=k,r+=3*k}var P=r;for(r++;;){var m=e[r++];if(!(m>=0))throw Error("Invalid block size");if(0===m)break;r+=m}d.push({x:b,y:w,width:_,height:A,has_local_palette:z,palette_offset:R,palette_size:q,data_offset:P,data_length:r-P,transparent_index:h,interlaced:!!U,delay:v,disposal:p});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[r-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return g},this.frameInfo=function(e){if(e<0||e>=d.length)throw new Error("Frame index out of range.");return d[e]},this.decodeAndBlitFrameBGRA=function(r,n){var i=this.frameInfo(r),o=i.width*i.height,f=new Uint8Array(o);t(e,i.data_offset,f,o);var s=i.palette_offset,l=i.transparent_index;null===l&&(l=256);var u=i.width,c=a-u,d=u,v=4*(i.y*a+i.x),h=4*((i.y+i.height)*a+i.x),p=v,g=4*c;!0===i.interlaced&&(g+=4*a*7);for(var m=8,y=0,b=f.length;y<b;++y){var w=f[y];if(0===d&&(p+=g,d=u,p>=h&&(g=4*c+4*a*(m-1),p=v+(u+c)*(m<<1),m>>=1)),w===l)p+=4;else{var _=e[s+3*w],A=e[s+3*w+1],I=e[s+3*w+2];n[p++]=I,n[p++]=A,n[p++]=_,n[p++]=255}--d}},this.decodeAndBlitFrameRGBA=function(r,n){var i=this.frameInfo(r),o=i.width*i.height,f=new Uint8Array(o);t(e,i.data_offset,f,o);var s=i.palette_offset,l=i.transparent_index;null===l&&(l=256);var u=i.width,c=a-u,d=u,v=4*(i.y*a+i.x),h=4*((i.y+i.height)*a+i.x),p=v,g=4*c;!0===i.interlaced&&(g+=4*a*7);for(var m=8,y=0,b=f.length;y<b;++y){var w=f[y];if(0===d&&(p+=g,d=u,p>=h&&(g=4*c+4*a*(m-1),p=v+(u+c)*(m<<1),m>>=1)),w===l)p+=4;else{var _=e[s+3*w],A=e[s+3*w+1],I=e[s+3*w+2];n[p++]=_,n[p++]=A,n[p++]=I,n[p++]=255}--d}}}function t(e,r,t,a){for(var n=e[r++],i=1<<n,o=i+1,f=o+1,s=n+1,l=(1<<s)-1,u=0,c=0,d=0,v=e[r++],h=new Int32Array(4096),p=null;;){for(;u<16&&0!==v;)c|=e[r++]<<u,u+=8,1===v?v=e[r++]:--v;if(u<s)break;var g=c&l;if(c>>=s,u-=s,g!==i){if(g===o)break;for(var m=g<f?g:p,y=0,b=m;b>i;)b=h[b]>>8,++y;var w=b;if(d+y+(m!==g?1:0)>a)return void console.log("Warning, gif stream longer than expected.");t[d++]=w,d+=y;var _=d;for(m!==g&&(t[d++]=w),b=m;y--;)b=h[b],t[--_]=255&b,b>>=8;null!==p&&f<4096&&(h[f++]=p<<8|w,f>=l+1&&s<12&&(++s,l=l<<1|1)),p=g}else f=o+1,s=n+1,l=(1<<s)-1,p=null}return d!==a&&console.log("Warning, gif stream shorter than expected."),t}e=e&&e.hasOwnProperty("default")?e["default"]:e;var a=function(e){var r=e.split(".");return r[r.length-1]},n={};return Uint8Array&&!Uint8Array.prototype.slice&&(Uint8Array.prototype.slice=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;return(t=new Uint8Array(this)).subarray.apply(t,e)}),function(e,r){e.toRGBA8=function(r){var t=r.width,a=r.height;if(null==r.tabs.acTL)return[e.toRGBA8.decodeImage(r.data,t,a,r).buffer];var n=[];null==r.frames[0].data&&(r.frames[0].data=r.data);for(var i,o=new Uint8Array(t*a*4),f=0;f<r.frames.length;f++){var s=r.frames[f],l=s.rect.x,u=s.rect.y,c=s.rect.width,d=s.rect.height,v=e.toRGBA8.decodeImage(s.data,c,d,r);if(0==f?i=v:0==s.blend?e._copyTile(v,c,d,i,t,a,l,u,0):1==s.blend&&e._copyTile(v,c,d,i,t,a,l,u,1),n.push(i.buffer),i=i.slice(0),0==s.dispose);else if(1==s.dispose)e._copyTile(o,c,d,i,t,a,l,u,0);else if(2==s.dispose){for(var h=f-1;2==r.frames[h].dispose;)h--;i=new Uint8Array(n[h]).slice(0)}}return n},e.toRGBA8.decodeImage=function(r,t,a,n){var i=t*a,o=e.decode._getBPP(n),f=Math.ceil(t*o/8),s=new Uint8Array(4*i),l=new Uint32Array(s.buffer),u=n.ctype,c=n.depth,d=e._bin.readUshort;if(6==u){var v=i<<2;if(8==c)for(var h=0;h<v;h++)s[h]=r[h];if(16==c)for(var h=0;h<v;h++)s[h]=r[h<<1]}else if(2==u){var p=n.tabs.tRNS,g=-1,m=-1,y=-1;if(p&&(g=p[0],m=p[1],y=p[2]),8==c)for(var h=0;h<i;h++){var b=h<<2,w=3*h;s[b]=r[w],s[b+1]=r[w+1],s[b+2]=r[w+2],s[b+3]=255,-1!=g&&r[w]==g&&r[w+1]==m&&r[w+2]==y&&(s[b+3]=0)}if(16==c)for(var h=0;h<i;h++){var b=h<<2,w=6*h;s[b]=r[w],s[b+1]=r[w+2],s[b+2]=r[w+4],s[b+3]=255,-1!=g&&d(r,w)==g&&d(r,w+2)==m&&d(r,w+4)==y&&(s[b+3]=0)}}else if(3==u){var _=n.tabs.PLTE,A=n.tabs.tRNS,I=A?A.length:0;if(1==c)for(var x=0;x<a;x++)for(var U=x*f,T=x*t,h=0;h<t;h++){var b=T+h<<2,k=r[U+(h>>3)]>>7-((7&h)<<0)&1,R=3*k;s[b]=_[R],s[b+1]=_[R+1],s[b+2]=_[R+2],s[b+3]=k<I?A[k]:255}if(2==c)for(var x=0;x<a;x++)for(var U=x*f,T=x*t,h=0;h<t;h++){var b=T+h<<2,k=r[U+(h>>2)]>>6-((3&h)<<1)&3,R=3*k;s[b]=_[R],s[b+1]=_[R+1],s[b+2]=_[R+2],s[b+3]=k<I?A[k]:255}if(4==c)for(var x=0;x<a;x++)for(var U=x*f,T=x*t,h=0;h<t;h++){var b=T+h<<2,k=r[U+(h>>1)]>>4-((1&h)<<2)&15,R=3*k;s[b]=_[R],s[b+1]=_[R+1],s[b+2]=_[R+2],s[b+3]=k<I?A[k]:255}if(8==c)for(var h=0;h<i;h++){var b=h<<2,k=r[h],R=3*k;s[b]=_[R],s[b+1]=_[R+1],s[b+2]=_[R+2],s[b+3]=k<I?A[k]:255}}else if(4==u){if(8==c)for(var h=0;h<i;h++){var b=h<<2,q=h<<1,z=r[q];s[b]=z,s[b+1]=z,s[b+2]=z,s[b+3]=r[q+1]}if(16==c)for(var h=0;h<i;h++){var b=h<<2,q=h<<2,z=r[q];s[b]=z,s[b+1]=z,s[b+2]=z,s[b+3]=r[q+2]}}else if(0==u){var g=n.tabs.tRNS?n.tabs.tRNS:-1;if(1==c)for(var h=0;h<i;h++){var z=255*(r[h>>3]>>7-(7&h)&1),P=z==255*g?0:255;l[h]=P<<24|z<<16|z<<8|z}if(2==c)for(var h=0;h<i;h++){var z=85*(r[h>>2]>>6-((3&h)<<1)&3),P=z==85*g?0:255;l[h]=P<<24|z<<16|z<<8|z}if(4==c)for(var h=0;h<i;h++){var z=17*(r[h>>1]>>4-((1&h)<<2)&15),P=z==17*g?0:255;l[h]=P<<24|z<<16|z<<8|z}if(8==c)for(var h=0;h<i;h++){var z=r[h],P=z==g?0:255;l[h]=P<<24|z<<16|z<<8|z}if(16==c)for(var h=0;h<i;h++){var z=r[h<<1],P=d(r,h<<1)==g?0:255;l[h]=P<<24|z<<16|z<<8|z}}return s},e.decode=function(r){for(var t,a=new Uint8Array(r),n=8,i=e._bin,o=i.readUshort,f=i.readUint,s={tabs:{},frames:[]},l=new Uint8Array(a.length),u=0,c=0,d=[137,80,78,71,13,10,26,10],v=0;v<8;v++)if(a[v]!=d[v])throw"The input is not a PNG file!";for(;n<a.length;){var h=i.readUint(a,n);n+=4;var p=i.readASCII(a,n,4);if(n+=4,"IHDR"==p)e.decode._IHDR(a,n,s);else if("IDAT"==p){for(var v=0;v<h;v++)l[u+v]=a[n+v];u+=h}else if("acTL"==p)s.tabs[p]={num_frames:f(a,n),num_plays:f(a,n+4)},t=new Uint8Array(a.length);else if("fcTL"==p){if(0!=c){var g=s.frames[s.frames.length-1];g.data=e.decode._decompress(s,t.slice(0,c),g.rect.width,g.rect.height),c=0}var m={x:f(a,n+12),y:f(a,n+16),width:f(a,n+4),height:f(a,n+8)},y=o(a,n+22);y=o(a,n+20)/(0==y?100:y);var b={rect:m,delay:Math.round(1e3*y),dispose:a[n+24],blend:a[n+25]};s.frames.push(b)}else if("fdAT"==p){for(var v=0;v<h-4;v++)t[c+v]=a[n+v+4];c+=h-4}else if("pHYs"==p)s.tabs[p]=[i.readUint(a,n),i.readUint(a,n+4),a[n+8]];else if("cHRM"==p){s.tabs[p]=[];for(var v=0;v<8;v++)s.tabs[p].push(i.readUint(a,n+4*v))}else if("tEXt"==p){null==s.tabs[p]&&(s.tabs[p]={});var w=i.nextZero(a,n),_=i.readASCII(a,n,w-n),A=i.readASCII(a,w+1,n+h-w-1);s.tabs[p][_]=A}else if("iTXt"==p){null==s.tabs[p]&&(s.tabs[p]={});var w=0,I=n;w=i.nextZero(a,I);var _=i.readASCII(a,I,w-I);I=w+1,I+=2,w=i.nextZero(a,I);i.readASCII(a,I,w-I);I=w+1,w=i.nextZero(a,I);i.readUTF8(a,I,w-I);I=w+1;var A=i.readUTF8(a,I,h-(I-n));s.tabs[p][_]=A}else if("PLTE"==p)s.tabs[p]=i.readBytes(a,n,h);else if("hIST"==p){var x=s.tabs.PLTE.length/3;s.tabs[p]=[];for(var v=0;v<x;v++)s.tabs[p].push(o(a,n+2*v))}else if("tRNS"==p)3==s.ctype?s.tabs[p]=i.readBytes(a,n,h):0==s.ctype?s.tabs[p]=o(a,n):2==s.ctype&&(s.tabs[p]=[o(a,n),o(a,n+2),o(a,n+4)]);else if("gAMA"==p)s.tabs[p]=i.readUint(a,n)/1e5;else if("sRGB"==p)s.tabs[p]=a[n];else if("bKGD"==p)0==s.ctype||4==s.ctype?s.tabs[p]=[o(a,n)]:2==s.ctype||6==s.ctype?s.tabs[p]=[o(a,n),o(a,n+2),o(a,n+4)]:3==s.ctype&&(s.tabs[p]=a[n]);else if("IEND"==p)break;n+=h;i.readUint(a,n);n+=4}if(0!=c){var g=s.frames[s.frames.length-1];g.data=e.decode._decompress(s,t.slice(0,c),g.rect.width,g.rect.height),c=0}return s.data=e.decode._decompress(s,l,s.width,s.height),delete s.compress,delete s.interlace,delete s.filter,s},e.decode._decompress=function(r,t,a,n){return 0==r.compress&&(t=e.decode._inflate(t)),0==r.interlace?t=e.decode._filterZero(t,r,0,a,n):1==r.interlace&&(t=e.decode._readInterlace(t,r)),t},e.decode._inflate=function(e){return r.inflate(e)},e.decode._readInterlace=function(r,t){for(var a=t.width,n=t.height,i=e.decode._getBPP(t),o=i>>3,f=Math.ceil(a*i/8),s=new Uint8Array(n*f),l=0,u=[0,0,4,0,2,0,1],c=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],v=[8,8,4,4,2,2,1],h=0;h<7;){for(var p=d[h],g=v[h],m=0,y=0,b=u[h];b<n;)b+=p,y++;for(var w=c[h];w<a;)w+=g,m++;var _=Math.ceil(m*i/8);e.decode._filterZero(r,t,l,m,y);for(var A=0,I=u[h];I<n;){for(var x=c[h],U=l+A*_<<3;x<a;){if(1==i){var T=r[U>>3];T=T>>7-(7&U)&1,s[I*f+(x>>3)]|=T<<7-((3&x)<<0)}if(2==i){var T=r[U>>3];T=T>>6-(7&U)&3,s[I*f+(x>>2)]|=T<<6-((3&x)<<1)}if(4==i){var T=r[U>>3];T=T>>4-(7&U)&15,s[I*f+(x>>1)]|=T<<4-((1&x)<<2)}if(i>=8)for(var k=I*f+x*o,R=0;R<o;R++)s[k+R]=r[(U>>3)+R];U+=i,x+=g}A++,I+=p}m*y!=0&&(l+=y*(1+_)),h+=1}return s},e.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},e.decode._filterZero=function(r,t,a,n,i){var o=e.decode._getBPP(t),f=Math.ceil(n*o/8),s=e.decode._paeth;o=Math.ceil(o/8);for(var l=0;l<i;l++){var u=a+l*f,c=u+l+1,d=r[c-1];if(0==d)for(var v=0;v<f;v++)r[u+v]=r[c+v];else if(1==d){for(var v=0;v<o;v++)r[u+v]=r[c+v];for(var v=o;v<f;v++)r[u+v]=r[c+v]+r[u+v-o]&255}else if(0==l){for(var v=0;v<o;v++)r[u+v]=r[c+v];if(2==d)for(var v=o;v<f;v++)r[u+v]=255&r[c+v];if(3==d)for(var v=o;v<f;v++)r[u+v]=r[c+v]+(r[u+v-o]>>1)&255;if(4==d)for(var v=o;v<f;v++)r[u+v]=r[c+v]+s(r[u+v-o],0,0)&255}else{if(2==d)for(var v=0;v<f;v++)r[u+v]=r[c+v]+r[u+v-f]&255;if(3==d){for(var v=0;v<o;v++)r[u+v]=r[c+v]+(r[u+v-f]>>1)&255;for(var v=o;v<f;v++)r[u+v]=r[c+v]+(r[u+v-f]+r[u+v-o]>>1)&255}if(4==d){for(var v=0;v<o;v++)r[u+v]=r[c+v]+s(0,r[u+v-f],0)&255;for(var v=o;v<f;v++)r[u+v]=r[c+v]+s(r[u+v-o],r[u+v-f],r[u+v-o-f])&255}}}return r},e.decode._paeth=function(e,r,t){var a=e+r-t,n=Math.abs(a-e),i=Math.abs(a-r),o=Math.abs(a-t);return n<=i&&n<=o?e:i<=o?r:t},e.decode._IHDR=function(r,t,a){var n=e._bin;a.width=n.readUint(r,t),t+=4,a.height=n.readUint(r,t),t+=4,a.depth=r[t],t++,a.ctype=r[t],t++,a.compress=r[t],t++,a.filter=r[t],t++,a.interlace=r[t],t++},e._bin={nextZero:function(e,r){for(;0!=e[r];)r++;return r},readUshort:function(e,r){return e[r]<<8|e[r+1]},writeUshort:function(e,r,t){e[r]=t>>8&255,e[r+1]=255&t},readUint:function(e,r){return 16777216*e[r]+(e[r+1]<<16|e[r+2]<<8|e[r+3])},writeUint:function(e,r,t){e[r]=t>>24&255,e[r+1]=t>>16&255,e[r+2]=t>>8&255,e[r+3]=255&t},readASCII:function(e,r,t){for(var a="",n=0;n<t;n++)a+=String.fromCharCode(e[r+n]);return a},writeASCII:function(e,r,t){for(var a=0;a<t.length;a++)e[r+a]=t.charCodeAt(a)},readBytes:function(e,r,t){for(var a=[],n=0;n<t;n++)a.push(e[r+n]);return a},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(r,t,a){for(var n,i="",o=0;o<a;o++)i+="%"+e._bin.pad(r[t+o].toString(16));try{n=decodeURIComponent(i)}catch(f){return e._bin.readASCII(r,t,a)}return n}},e._copyTile=function(e,r,t,a,n,i,o,f,s){for(var l=Math.min(r,n),u=Math.min(t,i),c=0,d=0,v=0;v<u;v++)for(var h=0;h<l;h++)if(o>=0&&f>=0?(c=v*r+h<<2,d=(f+v)*n+o+h<<2):(c=(-f+v)*r-o+h<<2,d=v*n+h<<2),0==s)a[d]=e[c],a[d+1]=e[c+1],a[d+2]=e[c+2],a[d+3]=e[c+3];else if(1==s){var p=e[c+3]*(1/255),g=e[c]*p,m=e[c+1]*p,y=e[c+2]*p,b=a[d+3]*(1/255),w=a[d]*b,_=a[d+1]*b,A=a[d+2]*b,I=1-p,x=p+b*I,U=0==x?0:1/x;a[d+3]=255*x,a[d+0]=(g+w*I)*U,a[d+1]=(m+_*I)*U,a[d+2]=(y+A*I)*U}else if(2==s){var p=e[c+3],g=e[c],m=e[c+1],y=e[c+2],b=a[d+3],w=a[d],_=a[d+1],A=a[d+2];p==b&&g==w&&m==_&&y==A?(a[d]=0,a[d+1]=0,a[d+2]=0,a[d+3]=0):(a[d]=g,a[d+1]=m,a[d+2]=y,a[d+3]=p)}else if(3==s){var p=e[c+3],g=e[c],m=e[c+1],y=e[c+2],b=a[d+3],w=a[d],_=a[d+1],A=a[d+2];if(p==b&&g==w&&m==_&&y==A)continue;if(p<220&&b>20)return!1}return!0},e.encode=function(r,t,a,n,i,o){null==n&&(n=0),null==o&&(o=!1);var f=e.encode.compress(r,t,a,n,!1,o);return e.encode.compressPNG(f,-1),e.encode._main(f,t,a,i)},e.encodeLL=function(r,t,a,n,i,o,f){for(var s={ctype:0+(1==n?0:2)+(0==i?0:4),depth:o,frames:[]},l=(n+i)*o,u=l*t,c=0;c<r.length;c++)s.frames.push({rect:{x:0,y:0,width:t,height:a},img:new Uint8Array(r[c]),blend:0,dispose:1,bpp:Math.ceil(l/8),bpl:Math.ceil(u/8)});return e.encode.compressPNG(s,4),e.encode._main(s,t,a,f)},e.encode._main=function(r,t,a,n){var i=e.crc.crc,o=e._bin.writeUint,f=e._bin.writeUshort,s=e._bin.writeASCII,l=8,u=r.frames.length>1,c=!1,d=46+(u?20:0);if(3==r.ctype){for(var v=r.plte.length,h=0;h<v;h++)r.plte[h]>>>24!=255&&(c=!0);d+=8+3*v+4+(c?8+1*v+4:0)}for(var p=0;p<r.frames.length;p++){var g=r.frames[p];u&&(d+=38),d+=g.cimg.length+12,0!=p&&(d+=4)}d+=12;for(var m=new Uint8Array(d),y=[137,80,78,71,13,10,26,10],h=0;h<8;h++)m[h]=y[h];if(o(m,l,13),l+=4,s(m,l,"IHDR"),l+=4,o(m,l,t),l+=4,o(m,l,a),l+=4,m[l]=r.depth,l++,m[l]=r.ctype,l++,m[l]=0,l++,m[l]=0,l++,m[l]=0,l++,o(m,l,i(m,l-17,17)),l+=4,o(m,l,1),l+=4,s(m,l,"sRGB"),l+=4,m[l]=1,l++,o(m,l,i(m,l-5,5)),l+=4,u&&(o(m,l,8),l+=4,s(m,l,"acTL"),l+=4,o(m,l,r.frames.length),l+=4,o(m,l,0),l+=4,o(m,l,i(m,l-12,12)),l+=4),3==r.ctype){var v=r.plte.length;o(m,l,3*v),l+=4,s(m,l,"PLTE"),l+=4;for(var h=0;h<v;h++){var b=3*h,w=r.plte[h],_=255&w,A=w>>>8&255,I=w>>>16&255;m[l+b+0]=_,m[l+b+1]=A,m[l+b+2]=I}if(l+=3*v,o(m,l,i(m,l-3*v-4,3*v+4)),l+=4,c){o(m,l,v),l+=4,s(m,l,"tRNS"),l+=4;for(var h=0;h<v;h++)m[l+h]=r.plte[h]>>>24&255;l+=v,o(m,l,i(m,l-v-4,v+4)),l+=4}}for(var x=0,p=0;p<r.frames.length;p++){var g=r.frames[p];u&&(o(m,l,26),l+=4,s(m,l,"fcTL"),l+=4,o(m,l,x++),l+=4,o(m,l,g.rect.width),l+=4,o(m,l,g.rect.height),l+=4,o(m,l,g.rect.x),l+=4,o(m,l,g.rect.y),l+=4,f(m,l,n[p]),l+=2,f(m,l,1e3),l+=2,m[l]=g.dispose,l++,m[l]=g.blend,l++,o(m,l,i(m,l-30,30)),l+=4);var U=g.cimg,v=U.length;o(m,l,v+(0==p?0:4)),l+=4;var T=l;s(m,l,0==p?"IDAT":"fdAT"),l+=4,0!=p&&(o(m,l,x++),l+=4);for(var h=0;h<v;h++)m[l+h]=U[h];l+=v,o(m,l,i(m,T,l-T)),l+=4}return o(m,l,0),l+=4,s(m,l,"IEND"),l+=4,o(m,l,i(m,l-4,4)),l+=4,m.buffer},e.encode.compressPNG=function(r,t){for(var a=0;a<r.frames.length;a++){var n=r.frames[a],i=(n.rect.width,n.rect.height),o=new Uint8Array(i*n.bpl+i);n.cimg=e.encode._filterZero(n.img,i,n.bpp,n.bpl,o,t)}},e.encode.compress=function(r,t,a,n,i,o){null==o&&(o=!1);for(var f=6,s=8,l=255,u=0;u<r.length;u++)for(var c=new Uint8Array(r[u]),d=c.length,v=0;v<d;v+=4)l&=c[v+3];var h=255!=l,p=h&&i,g=e.encode.framize(r,t,a,i,p),m={},y=[],b=[];if(0!=n){for(var w=[],v=0;v<g.length;v++)w.push(g[v].img.buffer);for(var _=e.encode.concatRGBA(w,i),A=e.quantize(_,n),I=0,x=new Uint8Array(A.abuf),v=0;v<g.length;v++){var U=g[v].img,T=U.length;b.push(new Uint8Array(A.inds.buffer,I>>2,T>>2));for(var u=0;u<T;u+=4)U[u]=x[I+u],U[u+1]=x[I+u+1],U[u+2]=x[I+u+2],U[u+3]=x[I+u+3];I+=T}for(var v=0;v<A.plte.length;v++)y.push(A.plte[v].est.rgba)}else for(var u=0;u<g.length;u++){var k=g[u],R=new Uint32Array(k.img.buffer),q=k.rect.width,d=R.length,z=new Uint8Array(d);b.push(z);for(var v=0;v<d;v++){var P=R[v];if(0!=v&&P==R[v-1])z[v]=z[v-1];else if(v>q&&P==R[v-q])z[v]=z[v-q];else{var M=m[P];if(null==M&&(m[P]=M=y.length,y.push(P),y.length>=300))break;z[v]=M}}}var E=y.length;E<=256&&0==o&&(s=E<=2?1:E<=4?2:E<=16?4:8,i&&(s=8));for(var u=0;u<g.length;u++){var k=g[u],q=(k.rect.x,k.rect.y,k.rect.width),D=k.rect.height,B=k.img,S=(new Uint32Array(B.buffer),4*q),N=4;if(E<=256&&0==o){S=Math.ceil(s*q/8);for(var L=new Uint8Array(S*D),C=b[u],G=0;G<D;G++){var v=G*S,F=G*q;if(8==s)for(var X=0;X<q;X++)L[v+X]=C[F+X];else if(4==s)for(var X=0;X<q;X++)L[v+(X>>1)]|=C[F+X]<<4-4*(1&X);else if(2==s)for(var X=0;X<q;X++)L[v+(X>>2)]|=C[F+X]<<6-2*(3&X);else if(1==s)for(var X=0;X<q;X++)L[v+(X>>3)]|=C[F+X]<<7-1*(7&X)}B=L,f=3,N=1}else if(0==h&&1==g.length){for(var L=new Uint8Array(q*D*3),Z=q*D,v=0;v<Z;v++){var U=3*v,H=4*v;L[U]=B[H],L[U+1]=B[H+1],L[U+2]=B[H+2]}B=L,f=2,N=3,S=3*q}k.img=B,k.bpl=S,k.bpp=N}return{ctype:f,depth:s,plte:y,frames:g}},e.encode.framize=function(r,t,a,n,i){for(var o=[],f=0;f<r.length;f++){var s=new Uint8Array(r[f]),l=new Uint32Array(s.buffer),u=0,c=0,d=t,v=a,h=0;if(0==f||i)s=s.slice(0);else{for(var p=n||1==f||2==o[o.length-2].dispose?1:2,g=0,m=1e9,y=0;y<p;y++){for(var b=new Uint8Array(r[f-1-y]),w=new Uint32Array(r[f-1-y]),_=t,A=a,I=-1,x=-1,U=0;U<a;U++)for(var T=0;T<t;T++){var k=U*t+T;l[k]!=w[k]&&(T<_&&(_=T),T>I&&(I=T),U<A&&(A=U),U>x&&(x=U))}var R=-1==I?1:(I-_+1)*(x-A+1);R<m&&(m=R,g=y,-1==I?(u=c=0,d=v=1):(u=_,c=A,d=I-_+1,v=x-A+1))}var b=new Uint8Array(r[f-1-g]);1==g&&(o[o.length-1].dispose=2);var q=new Uint8Array(d*v*4);e._copyTile(b,t,a,q,d,v,-u,-c,0),e._copyTile(s,t,a,q,d,v,-u,-c,3)?(e._copyTile(s,t,a,q,d,v,-u,-c,2),h=1):(e._copyTile(s,t,a,q,d,v,-u,-c,0),h=0),s=q}o.push({rect:{x:u,y:c,width:d,height:v},img:s,blend:h,dispose:i?1:0})}return o},e.encode._filterZero=function(t,a,n,i,o,f){if(-1!=f){for(var s=0;s<a;s++)e.encode._filterLine(o,t,s,i,n,f);return r.deflate(o)}for(var l=[],u=0;u<5;u++)if(!(a*i>5e5)||2!=u&&3!=u&&4!=u){for(var s=0;s<a;s++)e.encode._filterLine(o,t,s,i,n,u);if(l.push(r.deflate(o)),1==n)break}for(var c,d=1e9,v=0;v<l.length;v++)l[v].length<d&&(c=v,d=l[v].length);return l[c]},e.encode._filterLine=function(r,t,a,n,i,o){var f=a*n,s=f+a,l=e.decode._paeth;if(r[s]=o,s++,0==o)for(var u=0;u<n;u++)r[s+u]=t[f+u];else if(1==o){for(var u=0;u<i;u++)r[s+u]=t[f+u];for(var u=i;u<n;u++)r[s+u]=t[f+u]-t[f+u-i]+256&255}else if(0==a){for(var u=0;u<i;u++)r[s+u]=t[f+u];if(2==o)for(var u=i;u<n;u++)r[s+u]=t[f+u];if(3==o)for(var u=i;u<n;u++)r[s+u]=t[f+u]-(t[f+u-i]>>1)+256&255;if(4==o)for(var u=i;u<n;u++)r[s+u]=t[f+u]-l(t[f+u-i],0,0)+256&255}else{if(2==o)for(var u=0;u<n;u++)r[s+u]=t[f+u]+256-t[f+u-n]&255;if(3==o){for(var u=0;u<i;u++)r[s+u]=t[f+u]+256-(t[f+u-n]>>1)&255;for(var u=i;u<n;u++)r[s+u]=t[f+u]+256-(t[f+u-n]+t[f+u-i]>>1)&255}if(4==o){for(var u=0;u<i;u++)r[s+u]=t[f+u]+256-l(0,t[f+u-n],0)&255;for(var u=i;u<n;u++)r[s+u]=t[f+u]+256-l(t[f+u-i],t[f+u-n],t[f+u-i-n])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),r=0;r<256;r++){for(var t=r,a=0;a<8;a++)1&t?t=3988292384^t>>>1:t>>>=1;e[r]=t}return e}(),update:function(r,t,a,n){for(var i=0;i<n;i++)r=e.crc.table[255&(r^t[a+i])]^r>>>8;return r},crc:function(r,t,a){return 4294967295^e.crc.update(4294967295,r,t,a)}},e.quantize=function(r,t){for(var a=new Uint8Array(r),n=a.slice(0),i=new Uint32Array(n.buffer),o=e.quantize.getKDtree(n,t),f=o[0],s=o[1],l=(e.quantize.planeDst,a),u=i,c=l.length,d=new Uint8Array(a.length>>2),v=0;v<c;v+=4){var h=l[v]*(1/255),p=l[v+1]*(1/255),g=l[v+2]*(1/255),m=l[v+3]*(1/255),y=e.quantize.getNearest(f,h,p,g,m);d[v>>2]=y.ind,u[v>>2]=y.est.rgba}return{abuf:n.buffer,inds:d,plte:s}},e.quantize.getKDtree=function(r,t,a){null==a&&(a=1e-4);var n=new Uint32Array(r.buffer),i={i0:0,i1:r.length,bst:null,est:null,tdst:0,left:null,right:null};i.bst=e.quantize.stats(r,i.i0,i.i1),i.est=e.quantize.estats(i.bst);for(var o=[i];o.length<t;){for(var f=0,s=0,l=0;l<o.length;l++)o[l].est.L>f&&(f=o[l].est.L,s=l);if(f<a)break;var u=o[s],c=e.quantize.splitPixels(r,n,u.i0,u.i1,u.est.e,u.est.eMq255);if(u.i0>=c||u.i1<=c)u.est.L=0;else{var d={i0:u.i0,i1:c,bst:null,est:null,tdst:0,left:null,right:null};d.bst=e.quantize.stats(r,d.i0,d.i1),d.est=e.quantize.estats(d.bst);var v={i0:c,i1:u.i1,bst:null,est:null,tdst:0,left:null,right:null};v.bst={R:[],m:[],N:u.bst.N-d.bst.N};for(var l=0;l<16;l++)v.bst.R[l]=u.bst.R[l]-d.bst.R[l];for(var l=0;l<4;l++)v.bst.m[l]=u.bst.m[l]-d.bst.m[l];v.est=e.quantize.estats(v.bst),u.left=d,u.right=v,o[s]=d,o.push(v)}}o.sort(function(e,r){return r.bst.N-e.bst.N});for(var l=0;l<o.length;l++)o[l].ind=l;return[i,o]},e.quantize.getNearest=function(r,t,a,n,i){if(null==r.left)return r.tdst=e.quantize.dist(r.est.q,t,a,n,i),r;var o=e.quantize.planeDst(r.est,t,a,n,i),f=r.left,s=r.right;o>0&&(f=r.right,s=r.left);var l=e.quantize.getNearest(f,t,a,n,i);if(l.tdst<=o*o)return l;var u=e.quantize.getNearest(s,t,a,n,i);return u.tdst<l.tdst?u:l},e.quantize.planeDst=function(e,r,t,a,n){var i=e.e;return i[0]*r+i[1]*t+i[2]*a+i[3]*n-e.eMq},e.quantize.dist=function(e,r,t,a,n){var i=r-e[0],o=t-e[1],f=a-e[2],s=n-e[3];return i*i+o*o+f*f+s*s},e.quantize.splitPixels=function(r,t,a,n,i,o){var f=e.quantize.vecDot;for(n-=4;a<n;){for(;f(r,a,i)<=o;)a+=4;for(;f(r,n,i)>o;)n-=4;if(a>=n)break;var s=t[a>>2];t[a>>2]=t[n>>2],t[n>>2]=s,a+=4,n-=4}for(;f(r,a,i)>o;)a-=4;return a+4},e.quantize.vecDot=function(e,r,t){return e[r]*t[0]+e[r+1]*t[1]+e[r+2]*t[2]+e[r+3]*t[3]},e.quantize.stats=function(e,r,t){for(var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0],i=t-r>>2,o=r;o<t;o+=4){var f=e[o]*(1/255),s=e[o+1]*(1/255),l=e[o+2]*(1/255),u=e[o+3]*(1/255);n[0]+=f,n[1]+=s,n[2]+=l,n[3]+=u,a[0]+=f*f,a[1]+=f*s,a[2]+=f*l,a[3]+=f*u,a[5]+=s*s,a[6]+=s*l,a[7]+=s*u,a[10]+=l*l,a[11]+=l*u,a[15]+=u*u}return a[4]=a[1],a[8]=a[2],a[9]=a[6],a[12]=a[3],a[13]=a[7],a[14]=a[11],{R:a,m:n,N:i}},e.quantize.estats=function(r){var t=r.R,a=r.m,n=r.N,i=a[0],o=a[1],f=a[2],s=a[3],l=0==n?0:1/n,u=[t[0]-i*i*l,t[1]-i*o*l,t[2]-i*f*l,t[3]-i*s*l,t[4]-o*i*l,t[5]-o*o*l,t[6]-o*f*l,t[7]-o*s*l,t[8]-f*i*l,t[9]-f*o*l,t[10]-f*f*l,t[11]-f*s*l,t[12]-s*i*l,t[13]-s*o*l,t[14]-s*f*l,t[15]-s*s*l],c=u,d=e.M4,v=[.5,.5,.5,.5],h=0,p=0;if(0!=n)for(var g=0;g<10&&(v=d.multVec(c,v),p=Math.sqrt(d.dot(v,v)),v=d.sml(1/p,v),!(Math.abs(p-h)<1e-9));g++)h=p;var m=[i*l,o*l,f*l,s*l];return{Cov:u,q:m,e:v,L:h,eMq255:d.dot(d.sml(255,m),v),eMq:d.dot(v,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2])<<16|Math.round(255*m[1])<<8|Math.round(255*m[0])<<0)>>>0}},e.M4={multVec:function(e,r){return[e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],e[4]*r[0]+e[5]*r[1]+e[6]*r[2]+e[7]*r[3],e[8]*r[0]+e[9]*r[1]+e[10]*r[2]+e[11]*r[3],e[12]*r[0]+e[13]*r[1]+e[14]*r[2]+e[15]*r[3]]},dot:function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},sml:function(e,r){return[e*r[0],e*r[1],e*r[2],e*r[3]]}},e.encode.concatRGBA=function(e,r){for(var t=0,a=0;a<e.length;a++)t+=e[a].byteLength;for(var n=new Uint8Array(t),i=0,a=0;a<e.length;a++){for(var o=new Uint8Array(e[a]),f=o.length,s=0;s<f;s+=4){var l=o[s],u=o[s+1],c=o[s+2],d=o[s+3];r&&(d=0==(128&d)?0:255),0==d&&(l=u=c=0),n[i+s]=l,n[i+s+1]=u,n[i+s+2]=c,n[i+s+3]=d}i+=f}return n.buffer}}(n,e),function(){function e(e,r){var t=this;t.esource=e,t.resources=r,t.init()}return e.prototype.init=function(){var e=this,r=e.esource,t=e.resources;e.temp={events:{}},e.__attr={autoPlay:!0,loop:0},e.__method={play:e.play},e.__status={status:"init",frame:0,loops:0,time:0},e.ticker=new PIXI.Ticker,e.ticker.stop(),e.sprite=this.createSprite(r,t)},e.prototype.play=function(e,r){var t=this;if(!t.textures.length)throw new Error("没有可用的textures");if(1!==t.textures.length){var a=t.__status,n=t.__attr,i=0;"stop"===a.status&&(a.loops=0),e="number"==typeof e?e:n.loop,t.temp.loop=e,n.loop=e,t.temp.tickerIsAdd||(t.ticker.add(function(e){var n=PIXI.Ticker.shared.elapsedMS;(i+=n)>t.framesDelay[a.frame]&&(a.frame++,a.status="playing",a.frame>t.textures.length-1&&(a.frame=0,a.loops++,t.temp.loop>0&&a.loops>=t.temp.loop&&("function"==typeof r&&r(a),a.status="played",t.runEvent("played",a),t.stop())),t.sprite.texture=t.textures[a.frame],i=0,t.runEvent("playing",a))}),t.temp.tickerIsAdd=!0),t.ticker.start()}},e.prototype.pause=function(){var e=this,r=e.__status;e.ticker.stop(),r.status="pause",e.runEvent("pause",r)},e.prototype.stop=function(){var e=this,r=e.__status;e.ticker.stop(),r.status="stop",e.runEvent("stop",r)},e.prototype.jumpToFrame=function(e){var r=this,t=r.textures;if(!t.length)throw new Error("没有可用的textures");var a=r.__status;"number"==typeof(e=e<0?0:e>t.length-1?t.length-1:e)&&(r.sprite.texture=t[e],a.frame=e)},e.prototype.getDuration=function(){var e=this,r=e.framesDelay;if(!r.length)throw new Error("未找到图片帧时间");for(var t=0,a=0,n=r.length;a<n;a++)t+=r[a];return t},e.prototype.getFramesLength=function(){var e=this;if(!e.textures.length)throw new Error("没有可用的textures");return e.textures.length},e.prototype.on=function(e,r){var t=this;switch(e){case"playing":case"played":case"pause":case"stop":t.temp.events[e]=r;break;default:throw new Error("无效的事件")}},e.prototype.runEvent=function(e,r){var t=this.temp;"function"==typeof t.events[e]&&t.events[e](r)},e.prototype.createSprite=function(e,r){var t=this,n=PIXI.Sprite,i=e,o=a(i.toLocaleLowerCase());return o="gif"===o||"png"===o?o:"other",{gif:function(){var e=t.gifResourceToTextures(r[i]);return t.textures=e.textures,t.framesDelay=e.delayTimes,t.play(),new n(t.textures[0])},png:function(){var e=t.apngResourceToTextures(r[i]);return t.textures=e.textures,t.framesDelay=e.delayTimes,t.play(),new n(t.textures[0])},other:function(){return t.textures=[r[i].texture],new n(r[i].texture)}}[o]()},e.prototype.apngResourceToTextures=function(e){var r,t,a,i,o={delayTimes:[],textures:[]},f=new Uint8Array(e.data),s=n.decode(f),l=n.toRGBA8(s),u=s.width,c=s.height;s.frames.length;s.frames.forEach(function(e,r){o.delayTimes.push(e.delay)});for(var d=0,v=l.length;d<v;d++){var h=l[d],p=new Uint8ClampedArray(h);t=document.createElement("canvas"),t.width=u,t.height=c,a=t.getContext("2d"),r=new PIXI.BaseTexture.from(t),i=a.createImageData(u,c),i.data.set(p),a.putImageData(i,0,0),o.textures.push(new PIXI.Texture(r,new PIXI.Rectangle(0,0,u,c)))}return o},e.prototype.gifResourceToTextures=function(e){for(var t,a,n,i,o,f={delayTimes:[],textures:[]},s=new Uint8Array(e.data),l=new r(s),u=l.width,c=l.height,d=l.numFrames(),v=0;v<d;v++)t=l.frameInfo(v),f.delayTimes.push(10*t.delay),n=document.createElement("canvas"),n.width=u,n.height=c,i=n.getContext("2d"),o=i.createImageData(u,c),l.decodeAndBlitFrameRGBA(v,o.data),i.putImageData(o,0,0),a=new PIXI.BaseTexture.fromCanvas(n),f.textures.push(new PIXI.Texture(a,new PIXI.Rectangle(0,0,u,c)));return f},e}()});